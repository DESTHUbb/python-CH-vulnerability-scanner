import requests
import json
import base64
import config
import sys
email = config.fofa_email
key = config.fofa_key

def search(keyword,fields="ip,port,host,title"):
    b64_keyword = base64.b64encode(keyword.encode()).decode()
    proxies={"https":"127.0.0.1:7890"}
    url = "https://fofa.info/api/v1/search/all?email=%s&key=%s&qbase64=%s&size=10000&fields=%s" % (email,key,b64_keyword,fields)
    out = {}
    try:
        req = requests.get(url=url,timeout=60,proxies=proxies)
        out = json.loads(req.text)
        results = out
        if len(results) > 0 :
            for result in results['results']:
                print("%s%s    %s" % ((result[0]+":"+result[1]).ljust(21),result[2],result[3]))
    except Exception as e:
        print(e)
if __name__ == "__main__":
    search(sys.argv[1])

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////    

# Improvement:

import requests
import json
import base64
import config
import sys

FOFA_EMAIL = config.fofa_email
FOFA_KEY = config.fofa_key

def search(keyword, fields="ip,port,host,title"):

 b64_keyword = base64.b64encode(keyword.encode()).decode()
url = f"https://fofa.info/api/v1/search/all?email={FOFA_EMAIL}&key={FOFA_KEY}&qbase64={b64_keyword}&size=10000&fields={fields}"

try:
    response = requests.get(url, timeout=60)
    response.raise_for_status()
    results = response.json()
    
if len(results["results"]) > 0:
   for result in results["results"]:
    
    print(f"{result[0]}:{result[1]:<5}{result[2]:<30}{result[3]}")
    
    except requests.exceptions.RequestException as e:
      print(f"Request error: {e}")
    
if __name__ == "__main__":
    
